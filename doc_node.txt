# DocumentaÃ§Ã£o TÃ©cnica - Sistema Node.js

## 1. Estrutura de DiretÃ³rios
```
ğŸ“ raiz-projeto/
â”œâ”€â”€ ğŸ“„ .env                    # VariÃ¡veis de ambiente
â”œâ”€â”€ ğŸ“„ package.json           # ConfiguraÃ§Ãµes do projeto
â”œâ”€â”€ ğŸ“„ server.js              # Ponto de entrada principal
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ config/            # ConfiguraÃ§Ãµes do sistema
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ database.js    # ConfiguraÃ§Ã£o do banco de dados
â”‚   â”‚   â””â”€â”€ ğŸ“„ app.js        # ConfiguraÃ§Ã£o do Express
â”‚   â”œâ”€â”€ ğŸ“ controllers/       # Controladores da aplicaÃ§Ã£o
â”‚   â”‚   â””â”€â”€ ğŸ“„ UserController.js
â”‚   â”œâ”€â”€ ğŸ“ models/           # Modelos de dados
â”‚   â”‚   â””â”€â”€ ğŸ“„ User.js
â”‚   â”œâ”€â”€ ğŸ“ middlewares/      # Middlewares personalizados
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ auth.js
â”‚   â”‚   â””â”€â”€ ğŸ“„ error.js
â”‚   â”œâ”€â”€ ğŸ“ routes/           # Rotas da API
â”‚   â”‚   â””â”€â”€ ğŸ“„ userRoutes.js
â”‚   â”œâ”€â”€ ğŸ“ services/         # Camada de serviÃ§os
â”‚   â”‚   â””â”€â”€ ğŸ“„ UserService.js
â”‚   â””â”€â”€ ğŸ“ utils/            # UtilitÃ¡rios
â”‚       â””â”€â”€ ğŸ“„ logger.js
â”œâ”€â”€ ğŸ“ tests/                # Testes automatizados
â””â”€â”€ ğŸ“„ Dockerfile            # ConfiguraÃ§Ã£o Docker
```

## 2. Ãrvore de DependÃªncias de MÃ³dulos
```
AplicaÃ§Ã£o (Express)
â”œâ”€â”€ ConfiguraÃ§Ã£o
â”‚   â”œâ”€â”€ Database (MySQL2)
â”‚   â””â”€â”€ Environment (.env)
â”œâ”€â”€ Middlewares
â”‚   â”œâ”€â”€ Authentication
â”‚   â”œâ”€â”€ Error Handler
â”‚   â””â”€â”€ Request Logger
â”œâ”€â”€ Controllers
â”‚   â””â”€â”€ UserController
â”‚       â”œâ”€â”€ UserService
â”‚       â””â”€â”€ UserModel
â””â”€â”€ Routes
    â””â”€â”€ UserRoutes
```

## 3. Fluxo de Middlewares
```
Request â†’ Logger â†’ Auth â†’ Controller â†’ Response
   â†“         â†“       â†“         â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          Error Handler
```

## 4. DocumentaÃ§Ã£o TÃ©cnica Detalhada

### MÃ³dulos Principais

#### Database (src/config/database.js)
- **PropÃ³sito**: Gerenciamento de conexÃµes com MySQL
- **MÃ©todos**:
  - `conectar()`: Promise<Pool>
  - `obterConexao()`: Promise<Connection>
- **Eventos**:
  - 'conexao:obtida'
  - 'conexao:erro'

#### AutenticaÃ§Ã£o (src/middlewares/auth.js)
- **Fluxo**:
  1. ExtraÃ§Ã£o do token do cabeÃ§alho
  2. ValidaÃ§Ã£o JWT
  3. Anexar usuÃ¡rio ao request
- **CÃ³digos de Erro**:
  - 401: NÃ£o autorizado
  - 403: Proibido

#### UserController (src/controllers/UserController.js)
- **Endpoints**:
  - GET /usuarios
  - POST /usuarios
  - PUT /usuarios/:id
  - DELETE /usuarios/:id
- **ValidaÃ§Ãµes**:
  - Schema Validation
  - PermissÃµes de Acesso

### Scripts NPM
```json
{
  "scripts": {
    "start": "node src/server.js",
    "dev": "nodemon src/server.js",
    "test": "jest",
    "migrate": "knex migrate:latest",
    "lint": "eslint src/"
  }
}
```

### VariÃ¡veis de Ambiente (.env)
```
NODE_ENV=development
PORT=3000
DB_HOST=localhost
DB_USER=root
DB_PASS=senha
DB_NAME=banco
JWT_SECRET=chave_secreta
```

### DependÃªncias Principais
- express: ^4.18.0
- mysql2: ^3.0.0
- jsonwebtoken: ^9.0.0
- dotenv: ^16.0.0
- winston: ^3.8.0

### PadrÃµes de Projeto
1. **Repository Pattern**
   - SeparaÃ§Ã£o da lÃ³gica de acesso a dados
   - Interfaces consistentes para operaÃ§Ãµes CRUD

2. **Service Layer**
   - Encapsulamento da lÃ³gica de negÃ³cios
   - ReutilizaÃ§Ã£o de cÃ³digo entre controllers

3. **Middleware Chain**
   - Processamento sequencial de requisiÃ§Ãµes
   - SeparaÃ§Ã£o clara de responsabilidades

### Tratamento de Erros
```javascript
class ApiError extends Error {
  constructor(statusCode, mensagem) {
    super(mensagem);
    this.statusCode = statusCode;
  }
}

// Middleware de erro global
app.use((err, req, res, next) => {
  logger.error(err.stack);
  res.status(err.statusCode || 500).json({
    erro: err.message
  });
});
```

### Eventos AssÃ­ncronos
- UtilizaÃ§Ã£o de Promises/Async-Await
- Event Emitter para logs e monitoramento
- Graceful shutdown para conexÃµes

### SeguranÃ§a
- Helmet para headers HTTP
- Rate Limiting
- SanitizaÃ§Ã£o de entrada
- ValidaÃ§Ã£o de dados
- CORS configurÃ¡vel

### Logging
- Winston para logs estruturados
- NÃ­veis: error, warn, info, debug
- RotaÃ§Ã£o de arquivos de log
- Formato JSON para logs em produÃ§Ã£o

### Testes
- Jest para testes unitÃ¡rios
- Supertest para testes de API
- Mocks para dependÃªncias externas
- Coverage reports

### Docker
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```